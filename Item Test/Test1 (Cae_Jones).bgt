#include "sound_pool.bgt"

class Item {
 int x; int y; int slot;
 Item(int xx, int yy) {x=xx; y=yy;}
 }

 // I make this function for my own convenience, you can ignore it if you want.
 Item@ newItem(int x, int y) {Item ret(x, y); return ret;}


 Item@[] items;
 int[][] map; // You can put whatever you want in the grid, maybe for terrain or traps or whatever.


 int myX=0; int myY=0;
 int itemsCollected=0;
 sound_pool pool;

 void main() {
show_game_window("Test");

 // Let's give the pool a behind_pitch_decrease that is somewhat large to help distinguish items better when several are active at once.
 pool.behind_pitch_decrease=4;

 // Resize the map.
 map.resize(10);
 for(uint i=0; i<map.length(); i++) {map[i].resize(10);}
 myX=5; myY=5;

 // We'll create three items, and position them randomly.
 for(uint i=0; i<3; i++) {
Item@ it=newItem(random(0, 9), random(0, 9));
it.slot= pool.play_2d("sounds/item.wav", myX, myY, it.x, it.y, true); wait(100);
 items.insert_last(it);
 // The wait is called so that the signals are playing at different times.
 }


 while (true) {
 if((key_down(KEY_LMENU))&&(key_down(KEY_F4))) exit();

 if(key_pressed(KEY_LEFT)) move(myX-1, myY);
 else if(key_pressed(KEY_RIGHT)) move(myX+1, myY);
 else if(key_pressed(KEY_UP)) move(myX, myY+1);
 else if(key_pressed(KEY_DOWN)) move(myX, myY-1);
 else if(key_pressed(KEY_RETURN)) {
 // We only do this once, so it doesn't get its own function.
 // You might want a function in whatever you wind up making, though.
 for(uint i=0; i<items.length(); i++) {
 if((items[i].x==myX)&&(items[i].y==myY)) {
 pool.play_2d("sounds/item_collected.wav", myX, myY, myX, myY, false);
 itemsCollected++;
pool.destroy_sound(items[i].slot);
 items.remove_at(i);
 if(items.length()==0) {

 // Either generate more items or exit.
 alert("Map cleared", "You have collected all of the items.");
 exit();
 }
 }// Pick up the item.

}// Items loop.
}// Enter.
 pool.update_listener_2d(myX, myY);
 wait(5);
}// Main loop.

 }// Main.


 // This function tries to move the player.
 void move(int tx, int ty) {

 if((tx<0)||(tx>map.length()-1)||(ty<0)||(ty>map[myX].length()-1)) pool.play_2d("sounds/bump.wav", myX, myY, tx, ty, false);
 else {myX=tx; myY=ty; pool.play_2d("sounds/step.wav", myX, myY, myX, myY, false);
}
}
